version: '3'

tasks:
  build:
    cmds:
      - go build -o output/symctl main.go
  run:
    cmds:
      - task: build
      - ./output/symctl foo bar --baz
  clean:
    cmds:
      - rm -rf output
      - rm -rf ~/.symctl-tests
      - go clean
  prepare-test-plugin:
    cmds:
      - |
        mkdir -p ~/.symctl-tests/bin
        cat > ~/.symctl-tests/bin/symctl-foo <<EOF
        #!/bin/bash
        echo "Hello, world from foo plugin!"
        echo "Args: \$@"
        echo "One!"
        sleep 1
        echo "Two!"
        sleep 1
        echo "Three!"
        echo "Done!"
        EOF
        chmod +x ~/.symctl-tests/bin/symctl-foo
    silent: false
  test:
    cmds:
    - task: build
    - task: prepare-test-plugin
    - export PATH=~/.symctl-tests/bin:$PATH && /Users/mateusz/.symctl-tests/bin/symctl-foo bar --baz
    - export PATH=~/.symctl-tests/bin:$PATH && ./output/symctl version
    - export PATH=~/.symctl-tests/bin:$PATH && ./output/symctl install https://lalala.com/symctl-foo --version 1.0.0
    - export PATH=~/.symctl-tests/bin:$PATH && ./output/symctl install https://lalala.com/symctl-foo
    - export PATH=~/.symctl-tests/bin:$PATH && ./output/symctl install
    - export PATH=~/.symctl-tests/bin:$PATH && ./output/symctl foo bar --baz
